<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script
        src="https://unpkg.com/aframe-environment-component@1.0.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script>
    <script src="/../../dist/aframe-babia-components.js"></script>
    <script>
        AFRAME.registerComponent('change-matrix', {
            schema: {},
            init: function () {
                let el = this.el;
                el.addEventListener('mouseenter', function () {
                    el.setAttribute('material', { 'color': 'blue' });

                    //get matrix dimension
                    fetch('./data.json')
                        .then((response) => response.json())
                        .then((json) => {

                            let graphic = document.querySelector('#graphic');
                            let attr = graphic.getAttribute('babia-bubbles-plot');

                            //create a new transform matrix
                            let newMatrix = [[], [], []];
                            for (let i = 0; i < newMatrix.length; i++) {
                                for (let j = 0; j < json.length; j++) {
                                    newMatrix[i].push(Math.floor(Math.random() * 5));
                                }
                            }
                            console.log('New transform matrix', newMatrix);
                            attr.transform_matrix = JSON.stringify(newMatrix);
                            graphic.setAttribute('babia-bubbles-plot', attr);
                        });
                });

                el.addEventListener('mouseleave', function () {
                    el.setAttribute('material', { 'color': 'white' });
                });
            }
        });
    </script>
</head>

<body>
    <a-scene>
        <!-- Environment -->
        <a-entity environment></a-entity>
        <!-- Light -->
        <a-light type="point" intensity="1" position="-10 20 30"></a-light>

        <!-- Camera -->
        <a-entity movement-controls="fly: true" position="0 5 20">
            <a-entity camera position="0 0 0" look-controls></a-entity>
            <a-entity cursor="rayOrigin:mouse"></a-entity>
        </a-entity>

        <!-- hands -->

        <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"
            sphere-collider="objects: .collidable" super-hands>
        </a-entity>

        <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"
            sphere-collider="objects: .collidable" super-hands>
        </a-entity>

        <a-entity id="data" babia-queryjson="url: ./data.json">
        </a-entity>

        <a-entity id="graphic" babia-bubbles-plot="from: data; 
                legend: true; 
                palette: ubuntu;
                x_axis: x;
                z_axis: z;
                height: y; 
                radius: x;
                form: cylinder;
                size: 2" position="-1 3 -2" scale="0.5 0.5 0.5
                position: 40 0 0">
        </a-entity>

        <a-entity id="change-tmatrix-button" geometry="primitive: box; width: 2; height: 2; depth: 2"
            material="color: white" position="0 1 6" change-matrix>
        </a-entity>

</body>

</html>